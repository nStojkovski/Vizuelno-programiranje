# **Battleship** v1.0
---
### 1. Околу играта

Играта насловена како „Battleship“ е апликација направена во Windows Form - C#, креирана од тим од двајца надежни развивачи на софтвер со име Никола². Учесниците во овој проект, инаку студенти на ФИНКИ се:

  - Никола Кушевски
  - Никола Стојковски

Играта е составена од 2 табли со полиња 8x8 (64 полиња). Целта е корисникот да избере како ќе ги наместо сопствените бродови, а потоа да наизменично погаѓа каде се бродовите на противникот додека тој ги погаѓа неговите. Корисникот/противникот е на ред се додека погодува, а редот го губи кога нема да погоди поле. Повеќе за идејата и концептот на оваа игра можете да најдете  [тука][wikipedia].

За целосна функционалност инсталирајте го фонтот кој е прикачен со решението, со цел подобар изглед на тајмерот во играта.

**Сите алгоритми се самостојно креирани, без консултација со интернет.**
### 2. Упатство за користење

Играта се отвора преку „.sln“ фајлот со што нејзиното егзекутирање ќе биде преку debug од Visual studio или преку двоен клик на Battleshipv1.exe во фолдерот Debug внатре во проектот. За да функционира, мора структурата на фолдерите да се запази и не смее да недостасуваат информации. 
Battleship ја имплементиравме така што во главната форма „Form1.cs“, пред истата да се појави, излегува екран за избор на нова игра, зачувана игра или помош.
- Со избор на полето „зачувана игра“ се продолжува онаму каде што завршила последно зачуваната игра.
- Со избор на полето „помош“ се отвора HTML документ во кориснички предодредениот пребарувач кој го прикажува упатството за користење.

![First Screen](http://i.imgur.com/PW88B3P.jpg)
- Со избор на полето „нова игра“ се отвора нова форма. Во истата има избор помеѓу внес на корисничко име (придружено со валидација и checkbox доколку сака истото да е запомнето) и избор на веќе запомнето корисничко име. 

![First Screen](http://i.imgur.com/1GelAa0.jpg)

Потоа следи форма на која корисникот може да ги намести своите бродови по желба или рандом. Тука се одбира и тежината на играта: лесно, средно, тешко. Тука може и да се избере ресетирање на мапата со цел започнување на местењето одново. Кога мапата ќе биде спремна, копчето „Следен брод“ се претвора во копче „Готово“. Со клик на копчето „Готово“ играта започнува. 

![First Screen](http://i.imgur.com/a08ILY0.jpg)

Корисникот погаѓа и е на ред се додека не промаши. Тогаш гаѓа компјутерот и е на ред се додека не промаши. Победник е оној кој ќе му ги сруши сите бродови на противникот. На крајот се покажува листа на најдобри времиња за конкретното ниво и порака за честитка доколку корисникот има едно од 5те најдобри нивоа.

![First Screen](http://i.imgur.com/liQjPuR.jpg)
### 3. Имплементација на играта

##### 3.1 Позадинско чување на полињата
Играта вклучува разновидни постоечки C# елементи и елементи дефинирани од нас. Полињата на корисникот и на компјутерот се чуваат во матрици [8,8] така што на местата каде што нема брод стои 0, каде што има дел од брод со 2 полиња стои 2 и така натаму. Играта содржи 4 различни бродови - од по 5 полиња, 4 полиња, 3 полиња и 2 полиња, соодветно. 

Дозволен е пристап до секое поле преку get и set методи. Визуелно, матриците се поврзани со две табли од копчиња кои можат да се кликаат и дизајнерски ги имаат имињата - на пример: u11 кореспондира со grid[0,0] на корисникот, c23 кореспондира со grid[1,2] на компјутерот итн. Копчињата на корисникот се disabled за да не може корисникот да ги кликнува. При клик на копче на таблата на компјутерот се активира функција (заедничка за сите копчиња) која го проверува идентитетот на копчето кој се чува во sender и проверува дали соодветното поле е празно или има брод. Доколку има брод се појавува експлозија и чад, во спротивно се појавува прскање на водата и се гледа вода. Овие функционалности се проследени со звуци, соодветно. 

При погодување на поле, корисникот погаѓа повторно. Во спротивно, се иницира акција на компјутерот, кој погаѓа по случаен избор од листа на сите полиња кои не ги погодил. За таа цел имплементирани се три нивоа на тежина - лесно, средно и тешко.
- Лесно: Компјутерот погаѓа по случаен избор од листата на сите достапни полиња. Доколку не погоди, чека да заврши корисникот и погаѓа одново. Доколку погоди, ги става сите соседни полиња во приоритетна листа од кои ќе погаѓа следно. Бидејќи нивото е лесно, овој алгоритам при секој срушен брод ќе погаѓа на сите полиња кои го опкружуваат додека не ги поништи сите.
- Средно: Компјутерот се однесува исто како на лесно, со една разлика: Кога ќе погоди поле, а неговиот сосед е погоден претходно - на пример тој од лево, ги додава во поприоритетната листа неговиот сосед од десно и вториот сосед од лево кои ја претставуваат насоката на која може да има брод. Со тоа бродот се уништува и не се кликнува околу него беспотребно.
- Тешко: Компјутерот се однесува исто како на средно, но бидејќи средно е можеби најблиску што можевме да стигнеме до човечкото играње: При непогодени 4 полиња по ред, **мами** и ја истражува матрицата на противникот така што го кликнува првото поле на кое има брод на противникот што не е потопено. Значи, тешко се однесува како и средно, со тоа што додава временска ограниченост за победа на корисникот.
##### 3.2. Типови на променливи, датотеки и податочни структури
Низ целиот код фигурираат булови променливи и други примитивни типови на променливи. За чување на информации, секаде се користат листи од стрингови. Се користи тајмер кој отчукува и ги брои секундите, претворајќи ги во изминато време кое корисникот го гледа.

Информациите за зачувување на игра, на корисничко име и негово вчитување, читање на рандом матрици - предефинирани, читање на најдобри времиња - одделни за секое ниво на тежина се прави преку читање од ".txt" фајлови кои се наоѓаат во Resources фолдерот и нивно соодветно доделување на матрица или листа.

Се користат for и while циклуси, if услови, switch и слично. Се користи конверзија од стринг во цел број.

Се користат повеќе функции, како на пример validHit(int a, int b) која проверува дали темето со одредените координати е валидно или излегува надвор од матрицата. Оваа функција е корисна кога на едно поле треба да му ги предодредиме соседите.
##### 3.3 Алгоритми кои се користат
Функцијата која му се припишува на клик на копче од таблата на корисникот - клик кој го извршува компјутерот - се вика userGridField_Hit(). Иницирана е од ComHit() која се повикува при непогодување на корисникот. Истата го прави следното:
- При лесно ниво компјутерот погаѓа по случаен избор од листата **fields** на сите достапни полиња. Доколку погоди, ги става сите соседни полиња во приоритетна листа **hitfields** од кои ќе погаѓа следно. Овој алгоритам при секој срушен брод ќе погаѓа на сите полиња кои го опкружуваат додека не ги поништи сите за да прејде на следен брод. При секое извршување ја повикува функцијата removeImpossible() која од листата за погодување ги брише темињата кои имаат четири промашени соседи и не е возможно да содржат брод. При средно ниво - кога ќе погоди поле, а неговиот сосед е погоден претходно - на пример тој од лево, ги додава во поприоритетната листа **medhitfields** неговиот сосед од десно и вториот сосед од лево кои ја претставуваат насоката на која може да има брод. Со тоа бродот се уништува и не се кликнува околу него беспотребно. Доколку е нивото тешко, дополнително испитува колку полиња се непогодени. При непогодени 4 полиња по ред, **мами** и ја истражува матрицата на противникот така што го кликнува првото поле на кое има брод на противникот што не е потопено. Значи, тешко се однесува како и средно, со тоа што додава временска ограниченост за победа на корисникот.
##### 2.4 Објаснување на функција од изворниот код

Функцијата која ќе ја објасниме е таа што се случува при клик на поле на противникот од страна на корисникот:
```c#
        private void comGridField_Hit(object sender, EventArgs e)
        {
            if (!finished && turn) //if the game is not finished and is our turn - only then we shall hit
            {
                int i, j;   //initializing coordinates
                var button = (Button)sender;    //finding out the identity of the button
                string name = button.Name.Substring(1);     //finding the coordinates - ex. u74 to 74
                i = Convert.ToInt16(name) / 10;     //getting the 7
                j = Convert.ToInt16(name) % 10;     //getting the 4
                comfields.Add(i + "" + j);      //which fields we hit for saving purposes
                if (comp.get(i, j) == 0)    //if we miss
                {
                    timer2.Stop();  //stop changing pictures in background
                    button.Image = System.Drawing.Image.FromFile(@"..\..\Resources\splash.gif");  //draw the splash
                    playSplSound();     //play the splash sound
                    WaitMSeconds(350);  //wait for the sound to finish
                    timer2.Start();     //start changing between water pictures to make animated disabled button
                    button.Image = System.Drawing.Image.FromFile(@"..\..\Resources\x.jpg"); //picture of water
                    button.Enabled = false; //the button is no longer clickable
                    turnBox.ResetText();    //it's no longer our turn
                    turnBox.AppendText("Компјутер е на ред.");  //it's computer's turn and we shall know
                    System.Threading.Thread.Sleep(700); // wait for 0.7 seconds before computer hit
                    resetButton.Enabled = false;    // can not reset while not our turn
                    saveButton.Enabled = false;     // can not save in computer's turn
                    if (hardCounter == 4) comHit(getFirstFullField());  
                        //if the level is hard and we have 4 successive misses - cheat
                    else comHit();  // else don't cheat
                }
                else    //if we hit a ship
                {
                   timer2.Stop(); // stop changing pictures in background  
                    button.Image = System.Drawing.Image.FromFile(@"..\..\Resources\exp.gif");   //draw the explosion
                    playExpSound(); //play the explosion sound
                    WaitMSeconds(400);  //wait for 0.4 seconds so the sound can finish
                    timer2.Start(); //start changing pictures of smoke in background on disabled button
                    button.Image = System.Drawing.Image.FromFile(@"..\..\Resources\smoke.png"); //draw smoke
                    button.Enabled = false; //not anymore
                    userCounter++;  //count the hits
                    if (userCounter == 14)  //if we hit all ship fields
                    {
                        timer1.Stop();  //stop the time
                        playWinSound(); //play the trumpet for winning
                        MessageBox.Show("Победи, " + username.Text + "! Честитки! Играта траеше " + timerBox.Text);
                            //congratulate the user
                        finished = true;    //it's finished, no more clicking!
                        turnBox.ResetText();    // no more turns
                        turnBox.AppendText(username.Text + " won!");    //the user won!
                        saveButton.Enabled = false; // it's silly to save a finished game
                        AppearHighscores(true); // show the highscores, maybe the user is between!
                    }
                }
            }
        }
    }
```
### 4. Верзија
Тековната верзија е 1.0, изработена во мај, 2016 како проект по курсот Визуелно Програмирање на ФИНКИ.

### 5. Планови за во иднина
Поради ограниченото време, успеавме да ја направиме играта онака како што посакувавме, но некои ситни детали останаа неимплементирани. Во натамошните верзии имаме во план да:
- Создадеме сопствена екстензија за датотеките
- Поправиме ситни багови кои ќе ги пријават корисниците
- Ја оптимизираме играта целосно за побрзо лоадирање на сите форми (најголемиот проблем е во сликите на позадина)

[wikipedia]: <https://en.wikipedia.org/wiki/Battleship_(game)>